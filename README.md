\{:toc}

# FIFA World Cup Qatar 2022 결과 예측 by Elo Rating
Elo Rating을 통해 `FIFA World Cup Qatar 2022`의 결과를 예측하였습니다.

# Introduction
## Elo Rating 소개
[킹무위키](https://namu.wiki/w/Elo%20%EB%A0%88%EC%9D%B4%ED%8C%85)를 참조하는 것이 가장 좋습니다.  
간단한 수식을 통해 계산할 수 있으며, 가장 중요한 점은
* 이기면 점수가 오르고, 지면 점수가 내려간다.
* 매 경기마다  팀의 점수 상승폭과 진 팀의 점수 하락폭은 같다.
* 강팀이 약팀에게 이기면 점수가 적게 오른다.
* 약팀이 강팀에게 이기면 점수가 크게 오른다.

정도로 요약할 수 있습니다.  
마찬가지로 간단한 수식을 통해 경기 전에 각 팀의 승리 확률을 예측할 수 있습니다.  
다만, 본래 승패가 결정나는 종목에 대해서 쓰이는 기법이므로 축구처럼 무승부가 많은 종목에는 적합하지 않습니다.  
하지만 FIFA도 2018년부터는 Elo Rating을 변형하여 FIFA Ranking을 산정하고 있습니다.

## 축구로의 접목
이러한 이유로 무승부 확률을 계산하기 위해서는 따로 공식을 제작해야 하는데, [Xiong et al. (2016)](https://ieeexplore.ieee.org/document/7810980)에서는 한 가지 방법을 제시하고 있습니다.  
공식은 다음과 같습니다.  
$$P(\text{draw}) = \cfrac{1}{\sqrt{2\pi}e}\exp{(-\cfrac{(dr/200)^2}{2e^2})}$$  
(단, $dr$은 홈 팀의 Elo Rating에서 원정 팀의 Elo Rating을 뺀 값)  
다만 해당 논문에서는 위 식에 의해 계산된 무승부 값을 반으로 나누어, 기존 두 플레이어의 승리 확률에서 각각 빼주는 방식을 취하고 있습니다.  
이 경우, 두 플레이어의 Elo Rating이 크게 차이나는 경우 약팀의 승리 확률이 0보다 작아질 수 있습니다.  
따라서 본 연구에서는 1에서 무승부 확률을 뺀 값을 '승부가 날 확률'로 정리하고, 그 값에 대해서 기존의 승리 확률을 곱하여 사용하겠습니다.  
또한 해당 논문에서 이용한 정규분포 곡선을 이용하되, 상수들은 새로 계산하였습니다.  
계산에는 Stochastic Gradient Descent를 이용했고, 자세한 계산 과정은 제 졸업논문에 기술되어 있지만 놀랍게도 제 졸업논문은 아마 어디에도 공개되지 않을 것 같습니다...  
최종적으로 무승부 확률은 다음과 같습니다.
$$P(\text{draw}) = \cfrac{c}{\sqrt{2\pi}\sigma}\exp{(-\cfrac{(dr/400)^2}{2\sigma^2})}, \quad c =  0.527, \sigma = 0.693$$  
홈 팀에게는 홈 어드밴티지가 부여되는데, 이 역시 SGD를 통해 계산했고 약 86.4점 정도의 Elo Rating을 부여받게 됩니다.   
SGD 과정에서는 1872년 이후에 벌어진 모든 A매치 경기 데이터가 사용되었고, 이는 [martj42의 Github](https://github.com/martj42/international_results)에서 구할 수 있었습니다. 감사합니다.  

# 예측 결과
## Data
[World Football Elo Ratings](eloratings.net)에서 제공하는 Elo Rating을 사용하였습니다.  
2022년 9월 28일 현재 월드컵 진출국 Elo Rating은 다음과 같습니다.  
| 국가 | Elo Rating |
|:----:|:---:|
| 브라질 | 2166 |
| 아르헨티나 | 2140 |
| 스페인 | 2045 |
| 네덜란드 | 2040 |
| 벨기에 | 2025 |
| 프랑스 | 2005 |
| 포르투갈 | 2004 |
| 덴마크 | 1971 |
| 독일 | 1960 |
| 우루과이 | 1936 |
| 스위스 | 1929 |
| 크로아티아 | 1922 |
| 잉글랜드 | 1920 |
| 세르비아 | 1893 |
| 에콰도르 | 1840 |
| 멕시코 | 1821 |
| 이란 | 1817 |
| 폴란드 | 1809 |
| 미국 | 1798 |
| 일본 | 1798 |
| 웨일스 | 1790 |
| 대한민국 | 1783 |
| 캐나다 | 1770 |
| 모로코 | 1754 |
| 코스타리카 | 1737 |
| 카타르 | 1650 + 86.4  [\^Home Advantage] |
| 호주 | 1719 |
| 튀니지 | 1687 |
| 세네갈 | 1687 |
| 사우디아라비아 | 1632 |
| 카메룬 | 1613 |
| 가나 | 1541 |

## 결과 예측 예시
먼저 확률 계산기입니다.  
400점의 차이가 나면 확률은 다음과 같이 계산됩니다.
```{python}
expect_result(400)
>> (0.819, 0.099, 0.082, 2.55)
```
순서대로 강팀의 승리 확률, 무승부 확률, 약팀의 승리 확률, 강팀의 기대 승점입니다.

## 조별 기대 승점 순위
각 조마다 각 팀이 3경기동안 얻을 수 있는 기대 승점을 계산해보았습니다.
### A조
| 국가 | 기대 승점 |
|------|-----------|
|  |    |
|  |    |
|  |    |
|  |    |
### B조
| 국가 | 기대 승점 |
|------|-----------|
|  |    |
|  |    |
|  |    |
|  |    |
### C조
| 국가 | 기대 승점 |
|------|-----------|
|  |    |
|  |    |
|  |    |
|  |    |
### D조
| 국가 | 기대 승점 |
|------|-----------|
|  |    |
|  |    |
|  |    |
|  |    |
### E조
| 국가 | 기대 승점 |
|------|-----------|
|  |    |
|  |    |
|  |    |
|  |    |
### F조
| 국가 | 기대 승점 |
|------|-----------|
|  |    |
|  |    |
|  |    |
|  |    |
### G조
| 국가 | 기대 승점 |
|------|-----------|
|  |    |
|  |    |
|  |    |
|  |    |
### H조
| 국가 | 기대 승점 |
|------|-----------|
|  |    |
|  |    |
|  |    |
|  |    |

## 대한민국 경기 결과 예측
대한민국의 경기 결과 예측은 다음과 같습니다.
```
vs 우루과이
승리 확률 : 23.25%  
무승부 확률 : 25.90%  
패배 확률 : 50.86%   
기대 승점 : 0.96점  

vs 가나
승리 확률 : 67.27%  
무승부 확률 : 18.18%  
패배 확률 : 14.55%  
기대 승점 : 2.20점  

vs 포르투갈
승리 확률 : 19.05%  
무승부 확률 : 22.75%  
패배 확률 : 58.20%  
기대 승점 : 0.80점  
```

## 대한민국의 16강 진출 확률 시뮬레이션
이런 식으로 매 경기 시뮬레이션을 돌리면 됩니다.  
각 조에서 열리는 6경기에 대해 모두 시뮬레이션을 돌리고, 결과를 종합하면 되는데, 문제가 있습니다.  
Elo Rating으로는 득점과 실점까지 예측할 수 없다는 것입니다. (마음 먹으면 가능하겠지만..)  
그래서 '승점이 동률이면 Elo Rating이 높은 팀을 높은 순위로 배치한다'는 룰을 그냥 만들었습니다.  
(분명 대한민국에게는 불리한 룰입니다.)  
아무튼 10만번 시뮬레이션 해본 결과는 다음과 같습니다.  
```
1위 확률 : 11.08%  
2위 확률 : 23.07%  
3위 확률 : 50.60%  
4위 확률 : 15.25%  
```

## 전체 토너먼트 계산
토너먼트에서는 승부를 가리지 못한 경우 승부차기가 진행됩니다. (120분간 진행되니 무승부 확률이 조금 더 낮아지겠지만 패스..)  
승부차기에 돌입하면 승률은 50%가 되는 룰을 도입하였습니다.  
각 국가별로 10000번 시뮬레이션 해본 결과는 다음과 같습니다.
### 대한민국
16강 진출 확률 : 34.20%  
8강 진출 확률 : 9.12%  
4강 진출 확률 : 3.09%  
결승 진출 확률 : 1.03%  
우승 확률 : 0.34%  
### 일본
16강 진출 확률 : 21.40%  
8강 진출 확률 : 6.85%    
4강 진출 확률 : 2.00%  
결승 진출 확률 : 0.63%  
우승 확률 : 0.18%  
### 아르헨티나
16강 진출 확률 : 96.02%  
8강 진출 확률 : 68.49%  
4강 진출 확률 : 50.71%  
결승 진출 확률 : 29.99%  
우승 확률 : 19.45%  
### 브라질
16강 진출 확률 : 95.48%  
8강 진출 확률 : 70.44%  
4강 진출 확률 : 48.88%  
결승 진출 확률 : 32.26%  
우승 확률 : 21.98%  
### 프랑스
16강 진출 확률 : 88.37%  
8강 진출 확률 : 52.91%  
4강 진출 확률 : 34.44%  
결승 진출 확률 : 17.92%  
우승 확률 : 8.56% 
### 포르투갈
16강 진출 확률 : 85.72%  
8강 진출 확률 : 46.38%  
4강 진출 확률 : 24.52%  
결승 진출 확률 : 13.49%  
우승 확률 : 5.90%  
### 우루과이
16강 진출 확률 : 75.89%  
8강 진출 확률 : 31.52%  
4강 진출 확률 : 15.09%  
결승 진출 확률 : 7.14%  
우승 확률 : 2.93%  
### 잉글랜드
16강 진출 확률 : 72.67%  
8강 진출 확률 : 41.59%  
4강 진출 확률 : 19.07%  
결승 진출 확률 : 8.27%  
우승 확률 : 3.46%  

## 우승 확률 계산
50000번 시뮬레이션 해본 결과는 다음과 같습니다.
| 국가 | 우승 확률 (%) |
|:----:|:---:|
| 브라질 | 21.63 |
|  |  |
|  |  |
|  |  |
|  |  |
|  |  |
|  |  |
|  |  |
|  |  |
|  |  |
|  |  |
|  |  |
|  |  |
|  |  |
|  |  |
|  |  |
|  |  |
|  |  |
|  |  |
|  |  |
|  |  |
|  |  |
|  |  |
|  |  |
|  |  |
|  |  |
|  |  |
|  |  |
|  |  |
|  |  |
|  |  |
|  |  |